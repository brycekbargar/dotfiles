---
- hosts: localhost
  vars:
    dotfiles: "{{ playbook_dir }}/.."
    debian: "{{ playbook_dir }}/../debian"
  tasks:
    - ansible.builtin.import_role:
        name: prepare
    - name: Install python3-apt
      become: true
      ansible.builtin.command:
        cmd: "apt install python3-apt --yes"
      changed_when: true
    - name: Run roles
      block:
        - ansible.builtin.import_role:
            name: debian
        - ansible.builtin.import_role:
            name: conda
        - ansible.builtin.import_role:
            name: zsh
        - ansible.builtin.import_role:
            name: vim
        - ansible.builtin.import_role:
            name: neovim
        - ansible.builtin.import_role:
            name: progs
      always:
        - name: Remove python3-apt
          become: true
          ansible.builtin.command:
            cmd: "apt --purge autoremove python3-apt python3 --yes"
          changed_when: true
